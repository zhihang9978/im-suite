# 志航密信 v1.6.0 快速开始指南

**版本**: v1.6.0 - 智能机器人管理版  
**更新日期**: 2024-12-19

---

## 🚀 5分钟快速部署

### 1. 克隆项目

```bash
git clone https://github.com/zhihang9978/im-suite.git
cd im-suite
```

### 2. 启动服务

```bash
# 使用Docker Compose一键启动
docker-compose up -d

# 或使用部署脚本
./server-deploy.sh start
```

### 3. 访问服务

- **Web端**: http://localhost
- **管理后台**: http://localhost:8081
- **API**: http://localhost:8080

### 4. 默认账号

**超级管理员**:
- 用户名: `admin`
- 密码: `Admin123!`

**测试用户**:
- 用户名: `testuser`
- 密码: `Test123!`

---

## 🤖 机器人功能快速使用

### 场景1: 管理员设置机器人（5分钟）

#### 步骤1: 登录管理后台
```
1. 访问 http://localhost:8081
2. 使用 admin / Admin123! 登录
```

#### 步骤2: 创建机器人
```
1. 点击左侧菜单"系统管理"
2. 切换到"🤖 机器人管理"标签
3. 点击"➕ 创建机器人"
4. 填写：
   - 名称: 用户管理机器人
   - 描述: 用于聊天管理用户
   - 类型: internal
   - 权限: ✅ create_user  ✅ delete_user
5. 点击"创建"
6. ⚠️ 立即复制并保存API密钥（只显示一次！）
```

#### 步骤3: 创建机器人用户
```
1. 切换到"👤 机器人用户"标签
2. 点击"➕ 创建机器人用户"
3. 填写：
   - 选择机器人: 用户管理机器人
   - 用户名: userbot
   - 昵称: 用户管理机器人
4. 点击"创建"
```

#### 步骤4: 授权测试用户
```
1. 切换到"🔑 用户授权"标签
2. 点击"➕ 授权用户"
3. 填写：
   - 用户ID: 2 （testuser的ID）
   - 机器人: 用户管理机器人
   - 过期时间: 留空（永不过期）
4. 点击"授权"
```

✅ **设置完成！现在testuser可以在聊天中使用机器人了**

---

### 场景2: 用户使用机器人（1分钟）

#### 步骤1: 登录聊天应用
```
1. 访问 http://localhost （Web端）
2. 使用 testuser / Test123! 登录
```

#### 步骤2: 搜索机器人
```
1. 在搜索框输入: userbot
2. 点击搜索结果中的"用户管理机器人"
3. 开始对话
```

#### 步骤3: 使用命令
```
# 查看帮助
/help

# 创建用户
/create phone=13800138001 username=demo1 password=Demo123! nickname=演示用户1

# 查看列表
/list

# 查看详情
/info user_id=101

# 删除用户
/delete user_id=101 reason=测试完成
```

✅ **完成！您已成功使用机器人创建和删除用户**

---

## 📱 三种使用方式对比

### 方式1: 聊天交互（推荐 ⭐⭐⭐⭐⭐）

**优点**:
- ✅ 无需代码知识
- ✅ 随时随地使用
- ✅ 即时反馈
- ✅ 移动端友好

**适合**:
- 运维人员快速操作
- 临时创建测试账号
- 日常用户管理

**示例**:
```
/create phone=13800138001 username=test1 password=Pass123!
```

---

### 方式2: 后台管理（推荐 ⭐⭐⭐⭐）

**优点**:
- ✅ 图形化界面
- ✅ 统一管理入口
- ✅ 实时统计查看
- ✅ 权限控制清晰

**适合**:
- 配置机器人
- 管理用户授权
- 查看统计和日志

**位置**:
```
管理后台 → 系统管理 → 相应标签页
```

---

### 方式3: API调用（推荐 ⭐⭐⭐）

**优点**:
- ✅ 批量操作
- ✅ 自动化脚本
- ✅ 集成到现有系统

**适合**:
- 批量导入用户
- 定时任务
- 系统集成

**示例**:
```python
import requests

headers = {
    "X-Bot-Auth": "Bot {api_key}:{api_secret}",
    "Content-Type": "application/json"
}

# 批量创建
for i in range(1, 101):
    requests.post(
        "http://localhost:8080/api/bot/users",
        json={
            "phone": f"1380013{i:04d}",
            "username": f"user{i}",
            "password": "Pass123!"
        },
        headers=headers
    )
```

---

## 🎯 常见操作

### 操作1: 批量创建测试用户

**方法1: 聊天（推荐）**
```
/create phone=13800138001 username=test1 password=Test123!
/create phone=13800138002 username=test2 password=Test123!
/create phone=13800138003 username=test3 password=Test123!
/list
```

**方法2: API脚本**
```python
# 见 docs/api/bot-api-restricted.md 中的Python示例
```

---

### 操作2: 查看和管理用户

**聊天方式**:
```
/list limit=10        # 查看前10个用户
/info user_id=123     # 查看用户详情
```

**后台方式**:
```
1. 系统管理 → 🤖 机器人管理
2. 点击机器人的"详情"按钮
3. 查看统计和日志
```

---

### 操作3: 清理测试账号

**聊天方式**:
```
/list                           # 查看列表
/delete user_id=101 reason=测试完成
/delete user_id=102 reason=测试完成
/delete user_id=103 reason=测试完成
```

---

### 操作4: 授权新用户使用机器人

**后台方式**:
```
1. 系统管理 → 🔑 用户授权
2. 点击"➕ 授权用户"
3. 输入用户ID: 5
4. 选择机器人
5. 点击"授权"
```

---

## 🔧 配置说明

### 环境变量（.env）

使用现有配置即可，无需额外设置：

```env
# 数据库（已有）
DB_HOST=mysql
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=zhihang_messenger

# Redis（已有，用于速率限制）
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
```

### 默认配置

机器人默认配置：
- 速率限制: 100次/分钟
- 每日限制: 10,000次/天
- 权限: 按需选择

---

## 📖 学习路径

### 初学者（管理员）

```
第1天: 了解基础
- 阅读 README.md
- 了解系统架构

第2天: 部署系统
- Docker部署
- 访问管理后台
- 创建测试用户

第3天: 使用机器人
- 创建机器人
- 创建机器人用户
- 授权并测试
```

### 进阶用户（开发者）

```
第1周: API集成
- 阅读 docs/api/bot-api-restricted.md
- 编写Python/Node.js脚本
- 实现批量操作

第2周: 自定义开发
- 了解后端架构
- 扩展机器人命令
- 集成到现有系统
```

---

## 🆘 常见问题

### Q1: 机器人不回复怎么办？
**A**: 检查：
1. 机器人用户是否创建成功？
2. 用户是否已授权？
3. 机器人状态是否为"激活"？

### Q2: 提示"权限不足"？
**A**: 需要管理员在"系统管理 → 🔑 用户授权"中授权您使用机器人。

### Q3: 不能删除某个用户？
**A**: 只能删除本机器人创建的用户。检查用户信息中的"由本机器人创建"字段。

### Q4: API密钥丢失了？
**A**: 
```
1. 系统管理 → 🤖 机器人管理
2. 找到对应机器人
3. 点击"详情" → "重新生成密钥"
4. 立即保存新密钥（旧密钥立即失效）
```

### Q5: 如何查看机器人使用统计？
**A**:
```
1. 系统管理 → 🤖 机器人管理
2. 查看机器人卡片上的统计数字
3. 或点击"详情"查看完整统计
```

---

## 📊 版本对比

| 功能 | v1.4.0 | v1.6.0 |
|------|--------|--------|
| API端点数 | 125个 | 143个 (+18) |
| 核心服务 | 23个 | 26个 (+3) |
| 数据表 | 35个 | 40个 (+5) |
| 2FA | ✅ | ✅ |
| 设备管理 | ✅ | ✅ |
| 机器人系统 | ❌ | ✅ NEW! |
| 聊天式管理 | ❌ | ✅ NEW! |
| 用户授权 | ❌ | ✅ NEW! |

---

## ✅ 下一步

1. **部署系统**: 使用Docker Compose一键部署
2. **创建机器人**: 在管理后台创建第一个机器人
3. **授权用户**: 授权团队成员使用机器人
4. **开始使用**: 在聊天中与机器人交互

---

**祝您使用愉快！** 🎉

有任何问题请查看完整文档或提交Issue。

