# 屏幕共享功能 - 快速测试指南

## 🚀 快速开始（5分钟测试）

### 步骤 1: 启动后端服务

```bash
# 在项目根目录
cd im-backend
go run main.go
```

✅ 确认看到：`服务启动成功 http://localhost:8080`

---

### 步骤 2: 打开演示页面

有两种方式：

#### 方式 A：直接打开（推荐）
直接在浏览器中打开文件：
```
examples/screen-share-demo.html
```

#### 方式 B：使用 HTTP 服务器
```bash
# 在项目根目录，使用Python启动简单HTTP服务器
python -m http.server 8000

# 然后在浏览器访问
http://localhost:8000/examples/screen-share-demo.html
```

---

### 步骤 3: 测试屏幕共享

1. **配置检查**（可选）
   - 通话 ID：默认 `call_demo_123456`
   - API 地址：默认 `http://localhost:8080/api`

2. **开始测试**
   - 点击 **"📺 开始共享屏幕"** 按钮
   - 选择要共享的内容（整个屏幕、窗口或浏览器标签页）
   - 点击 **"共享"** 确认

3. **验证功能**
   - ✅ 视频区域显示共享内容
   - ✅ 状态显示 "✅ 正在共享屏幕"
   - ✅ 日志显示操作记录

4. **测试质量切换**
   - 在下拉框中选择不同的质量级别
   - 观察视频质量变化

5. **停止共享**
   - 点击 **"🛑 停止共享"** 按钮
   - 或直接在浏览器中点击停止共享按钮

---

## 🧪 功能测试清单

### 基础功能
- [ ] 可以开始屏幕共享
- [ ] 可以正常显示共享内容
- [ ] 可以停止屏幕共享
- [ ] 日志记录正常

### 高级功能
- [ ] 可以切换质量（高清/标准/流畅）
- [ ] 可以开启/关闭系统音频
- [ ] 可以查询共享状态
- [ ] 浏览器停止共享按钮生效

### 错误处理
- [ ] 用户拒绝权限时有提示
- [ ] 重复开始共享时有错误提示
- [ ] 网络断开时有错误提示

---

## 📝 测试日志示例

成功的测试日志应该类似：

```
[10:30:15] [系统] 屏幕共享演示已就绪
[10:30:20] [信息] 准备开始屏幕共享 [质量:medium, 音频:false]
[10:30:22] [成功] 屏幕共享管理器已初始化
[10:30:24] [成功] 屏幕共享已开始
[10:31:30] [信息] 停止屏幕共享...
[10:31:31] [成功] 屏幕共享已停止
```

---

## ⚠️ 常见问题

### Q: 点击"开始共享"没有反应？

**A:** 可能的原因：
1. 后端服务未启动 → 检查控制台
2. 浏览器不支持 → 使用 Chrome/Edge/Firefox
3. 权限被拒绝 → 重新授权

### Q: 看不到共享内容？

**A:** 检查：
1. 是否选择了正确的共享内容
2. 浏览器是否授予了权限
3. 检查浏览器控制台是否有错误

### Q: 如何在两个浏览器窗口测试？

**A:** 
1. 在窗口A中开始共享
2. 在窗口B中点击"查询状态"
3. 应该看到窗口A的共享信息

---

## 🔍 调试技巧

### 1. 查看浏览器控制台

按 `F12` 打开开发者工具，查看：
- Console：查看日志和错误
- Network：查看API请求
- Sources：调试JavaScript代码

### 2. 检查后端日志

后端控制台应该显示：
```
[INFO] 用户 1 (测试用户) 开始屏幕共享，通话: call_demo_123456, 质量: medium, 音频: false
[INFO] 用户 1 停止屏幕共享，通话: call_demo_123456, 共享时长: 70秒
```

### 3. 测试API

使用 cURL 直接测试 API：

```bash
# 测试后端是否正常
curl http://localhost:8080/health

# 测试屏幕共享状态（需要替换TOKEN）
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8080/api/calls/call_demo_123456/screen-share/status
```

---

## 📋 浏览器要求

| 浏览器 | 最低版本 | 推荐版本 |
|--------|---------|---------|
| Chrome | 72+ | 最新版 ✅ |
| Edge | 79+ | 最新版 ✅ |
| Firefox | 66+ | 最新版 ✅ |
| Safari | 13+ | 最新版 ⚠️ |

⚠️ Safari 不支持系统音频共享

---

## 🎉 测试成功标准

如果以下所有项都通过，说明功能正常：

✅ 后端编译和运行正常  
✅ 演示页面可以访问  
✅ 可以开始屏幕共享  
✅ 视频显示正常  
✅ 可以切换质量  
✅ 可以停止共享  
✅ 状态查询正常  
✅ 日志记录完整  

---

## 💡 下一步

测试通过后，可以：

1. **查看完整文档**：`examples/SCREEN_SHARE_README.md`
2. **查看代码示例**：`examples/screen-share-example.js`
3. **集成到项目**：参考演示页面的实现

---

## 📞 需要帮助？

如有问题：
1. 检查 `examples/SCREEN_SHARE_README.md` 的常见问题部分
2. 查看浏览器控制台错误
3. 查看后端日志
4. 检查网络连接

---

**祝测试顺利！🎉**


