# å¿—èˆªå¯†ä¿¡ - æŠ€æœ¯æ–‡æ¡£

## ğŸ“– æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å¿—èˆªå¯†ä¿¡é¡¹ç›®çš„è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€APIæ–‡æ¡£ã€éƒ¨ç½²æŒ‡å—ã€å¼€å‘æŒ‡å—ç­‰ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨      â”‚    â”‚   ç®¡ç†åå°      â”‚    â”‚   ç§»åŠ¨ç«¯åº”ç”¨    â”‚
â”‚  (telegram-web) â”‚    â”‚   (im-admin)    â”‚    â”‚ (telegram-android) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   åç«¯æœåŠ¡      â”‚
                    â”‚  (im-backend)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL æ•°æ®åº“  â”‚    â”‚   Redis ç¼“å­˜    â”‚    â”‚   MinIO å­˜å‚¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

#### åç«¯æŠ€æœ¯æ ˆ
- **è¯­è¨€**: Go 1.21+
- **æ¡†æ¶**: Gin (Webæ¡†æ¶)
- **æ•°æ®åº“**: MySQL 8.0
- **ç¼“å­˜**: Redis 7.0
- **å­˜å‚¨**: MinIO (å¯¹è±¡å­˜å‚¨)
- **WebSocket**: Gorilla WebSocket
- **ORM**: GORM
- **è®¤è¯**: JWT
- **æ—¥å¿—**: Logrus

#### å‰ç«¯æŠ€æœ¯æ ˆ
- **Webç«¯**: React + Vite + TypeScript
- **ç®¡ç†åå°**: Vue3 + Element Plus + Pinia
- **ç§»åŠ¨ç«¯**: Kotlin + Jetpack Compose
- **UIæ¡†æ¶**: Ant Design (Web), Material Design (Android)
- **çŠ¶æ€ç®¡ç†**: Pinia (Vue), è‡ªå®šä¹‰ (Android)
- **HTTPå®¢æˆ·ç«¯**: Axios (Web), Retrofit2 (Android)

#### åŸºç¡€è®¾æ–½
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **åå‘ä»£ç†**: Nginx
- **ç›‘æ§**: è‡ªå®šä¹‰ç›‘æ§ç³»ç»Ÿ
- **CI/CD**: GitHub Actions
- **éƒ¨ç½²**: Docker Swarm / Kubernetes

## ğŸ”§ å¼€å‘ç¯å¢ƒæ­å»º

### ç¯å¢ƒè¦æ±‚
- Go 1.21+
- Node.js 18+
- Docker 20+
- MySQL 8.0
- Redis 7.0

### å¿«é€Ÿå¼€å§‹
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/zhihang-messenger.git
cd zhihang-messenger

# 2. å¯åŠ¨åŸºç¡€è®¾æ–½
docker-compose up -d mysql redis minio

# 3. å¯åŠ¨åç«¯æœåŠ¡
cd im-backend
go mod download
go run main.go

# 4. å¯åŠ¨å‰ç«¯æœåŠ¡
cd ../telegram-web
npm install
npm run dev

# 5. å¯åŠ¨ç®¡ç†åå°
cd ../im-admin
npm install
npm run dev
```

## ğŸ“¡ API æ–‡æ¡£

### è®¤è¯ API
```http
POST /api/auth/login
Content-Type: application/json

{
  "phone": "13800138000",
  "password": "password123"
}
```

### ç”¨æˆ· API
```http
GET /api/users/me
Authorization: Bearer <token>
```

### æ¶ˆæ¯ API
```http
POST /api/messages/send
Authorization: Bearer <token>
Content-Type: application/json

{
  "chat_id": "chat_001",
  "content": "Hello World",
  "type": "text"
}
```

### WebSocket API
```javascript
const ws = new WebSocket('ws://localhost:8080/ws');
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('æ”¶åˆ°æ¶ˆæ¯:', data);
};
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ç”¨æˆ·è¡¨ (users)
```sql
CREATE TABLE users (
  id VARCHAR(36) PRIMARY KEY,
  phone VARCHAR(20) UNIQUE NOT NULL,
  username VARCHAR(50),
  nickname VARCHAR(100),
  avatar VARCHAR(255),
  bio TEXT,
  password_hash VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### èŠå¤©è¡¨ (chats)
```sql
CREATE TABLE chats (
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(100),
  type ENUM('private', 'group', 'channel') NOT NULL,
  created_by VARCHAR(36),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (created_by) REFERENCES users(id)
);
```

### æ¶ˆæ¯è¡¨ (messages)
```sql
CREATE TABLE messages (
  id VARCHAR(36) PRIMARY KEY,
  chat_id VARCHAR(36) NOT NULL,
  sender_id VARCHAR(36) NOT NULL,
  content TEXT NOT NULL,
  type ENUM('text', 'image', 'video', 'audio', 'file') NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (chat_id) REFERENCES chats(id),
  FOREIGN KEY (sender_id) REFERENCES users(id)
);
```

## ğŸ” å®‰å…¨è®¾è®¡

### è®¤è¯ä¸æˆæƒ
- JWT Token è®¤è¯
- Token åˆ·æ–°æœºåˆ¶
- æƒé™æ§åˆ¶ä¸­é—´ä»¶
- ä¼šè¯ç®¡ç†

### æ•°æ®åŠ å¯†
- å¯†ç å“ˆå¸Œ (bcrypt)
- ä¼ è¾“åŠ å¯† (HTTPS/WSS)
- ç«¯åˆ°ç«¯åŠ å¯† (å¯é€‰)
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨

### å®‰å…¨æªæ–½
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
- SQL æ³¨å…¥é˜²æŠ¤
- XSS é˜²æŠ¤
- CSRF é˜²æŠ¤
- é€Ÿç‡é™åˆ¶

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# ä½¿ç”¨ Docker Swarm
docker stack deploy -c docker-stack.yml zhihang-messenger

# ä½¿ç”¨ Kubernetes
kubectl apply -f k8s/
```

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æ€§èƒ½ç›‘æ§
- API å“åº”æ—¶é—´ç›‘æ§
- æ•°æ®åº“æ€§èƒ½ç›‘æ§
- å†…å­˜å’ŒCPUä½¿ç”¨ç›‘æ§
- ç½‘ç»œæµé‡ç›‘æ§

### é”™è¯¯è¿½è¸ª
- åº”ç”¨é”™è¯¯æ—¥å¿—
- ç³»ç»Ÿé”™è¯¯æ—¥å¿—
- ç”¨æˆ·è¡Œä¸ºæ—¥å¿—
- å®‰å…¨äº‹ä»¶æ—¥å¿—

### æ—¥å¿—æ ¼å¼
```json
{
  "timestamp": "2024-12-19T10:30:00Z",
  "level": "INFO",
  "service": "im-backend",
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ",
  "user_id": "user_001",
  "ip": "192.168.1.100",
  "request_id": "req_001"
}
```

## ğŸ”„ CI/CD æµç¨‹

### æŒç»­é›†æˆ
1. ä»£ç æäº¤è§¦å‘æ„å»º
2. è¿è¡Œå•å…ƒæµ‹è¯•
3. è¿è¡Œé›†æˆæµ‹è¯•
4. ä»£ç è´¨é‡æ£€æŸ¥
5. å®‰å…¨æ‰«æ

### æŒç»­éƒ¨ç½²
1. æ„å»º Docker é•œåƒ
2. æ¨é€åˆ°é•œåƒä»“åº“
3. éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
4. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- åç«¯ Go å•å…ƒæµ‹è¯•
- å‰ç«¯ React ç»„ä»¶æµ‹è¯•
- ç§»åŠ¨ç«¯ Kotlin å•å…ƒæµ‹è¯•

### é›†æˆæµ‹è¯•
- API é›†æˆæµ‹è¯•
- æ•°æ®åº“é›†æˆæµ‹è¯•
- WebSocket é›†æˆæµ‹è¯•

### ç«¯åˆ°ç«¯æµ‹è¯•
- ç”¨æˆ·æµç¨‹æµ‹è¯•
- è·¨å¹³å°æµ‹è¯•
- æ€§èƒ½æµ‹è¯•

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- å¹¶å‘å¤„ç†ä¼˜åŒ–
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- ä»£ç åˆ†å‰²
- æ‡’åŠ è½½
- å›¾ç‰‡ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥

### ç§»åŠ¨ç«¯ä¼˜åŒ–
- å†…å­˜ç®¡ç†
- ç”µæ± ä¼˜åŒ–
- ç½‘ç»œä¼˜åŒ–
- å¯åŠ¨ä¼˜åŒ–

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
   - éªŒè¯è¿æ¥é…ç½®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **WebSocket è¿æ¥å¤±è´¥**
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - éªŒè¯ WebSocket é…ç½®
   - æ£€æŸ¥ä»£ç†è®¾ç½®

3. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
   - æ£€æŸ¥ MinIO æœåŠ¡çŠ¶æ€
   - éªŒè¯å­˜å‚¨é…ç½®
   - æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs im-backend

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs mysql

# æŸ¥çœ‹ Redis æ—¥å¿—
docker-compose logs redis
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- é‚®ç®±: support@zhihang-messenger.com
- æ–‡æ¡£: https://docs.zhihang-messenger.com
- ç¤¾åŒº: https://community.zhihang-messenger.com

### è´¡çŒ®æŒ‡å—
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ19æ—¥
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
