# 📋 志航密信 - 合规清单

## 概述

本文档列出了志航密信在中国大陆地区运营即时通讯服务需要遵守的法律法规和合规要求。

---

## 📜 法律法规依据

- **《网络安全法》**（2017年6月1日施行）
- **《数据安全法》**（2021年9月1日施行）
- **《个人信息保护法》**（2021年11月1日施行）
- **《互联网信息服务管理办法》**（2011年修订）
- **《即时通信工具公众信息服务发展管理暂行规定》**（2014年）
- **《网络信息内容生态治理规定》**（2020年）
- **《儿童个人信息网络保护规定》**（2019年）

---

## ✅ 合规检查清单

### 1. 隐私保护

#### 1.1 隐私政策 [必需]

**状态**: ⚠️ 待实施

**要求**:
- [ ] 提供《隐私政策》页面
- [ ] 说明收集的个人信息类型
- [ ] 说明信息使用目的和方式
- [ ] 说明信息存储位置和期限
- [ ] 说明用户权利（查看、修改、删除、导出）
- [ ] 说明第三方共享情况
- [ ] 获得用户明示同意

**实施位置**:
```
前端: im-admin/src/views/Privacy.vue
后端API: /api/legal/privacy
```

**模板**: 见附件A

---

#### 1.2 用户协议 [必需]

**状态**: ⚠️ 待实施

**要求**:
- [ ] 提供《用户服务协议》
- [ ] 明确服务内容和使用规则
- [ ] 明确用户行为规范
- [ ] 明确违规处理措施
- [ ] 明确免责声明
- [ ] 获得用户同意

**实施位置**:
```
前端: im-admin/src/views/Terms.vue
后端API: /api/legal/terms
```

---

#### 1.3 账号注销 [必需]

**状态**: ⚠️ 待实施

**要求**:
- [ ] 提供账号注销功能
- [ ] 注销后48小时内删除个人信息
- [ ] 保留法律要求的必要信息（如交易记录）
- [ ] 支持注销申诉机制

**实施位置**:
```
前端: 用户设置 -> 账号管理 -> 注销账号
后端API: DELETE /api/users/me/account
```

**实现代码**:
```go
// im-backend/internal/controller/user_controller.go
func (c *UserController) DeleteAccount(ctx *gin.Context) {
    userID := ctx.GetUint("user_id")
    
    // 1. 标记账号为待删除
    user, _ := c.userService.GetByID(userID)
    user.Status = "pending_deletion"
    user.DeletionScheduledAt = time.Now().Add(48 * time.Hour)
    c.userService.Update(user)
    
    // 2. 48小时后自动删除（定时任务）
    // 3. 保留日志90天（合规要求）
    // 4. 匿名化交易记录
    
    ctx.JSON(200, gin.H{
        "message": "账号将在48小时后永久删除",
        "deletion_time": user.DeletionScheduledAt,
    })
}
```

---

#### 1.4 数据导出 [必需]

**状态**: ⚠️ 待实施

**要求**:
- [ ] 用户可导出个人数据
- [ ] 导出格式：JSON或CSV
- [ ] 包含：个人资料、聊天记录、文件列表
- [ ] 7天内提供下载链接

**实施位置**:
```
前端: 用户设置 -> 隐私 -> 导出我的数据
后端API: POST /api/users/me/export
```

---

### 2. 内容管理

#### 2.1 实名认证 [可选]

**状态**: ⚠️ 预留接口

**要求**:
- [ ] 用户实名认证（手机号或身份证）
- [ ] 对接第三方实名认证服务
- [ ] 存储实名信息（加密）

**实施位置**:
```
后端API: POST /api/users/me/verify
配置: REAL_NAME_VERIFICATION_ENABLED=false
```

**建议**:
- 个人聊天：可不实名
- 公众号/群组超过100人：需实名

---

#### 2.2 内容审核 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] 文本内容审核（敏感词过滤）
- [x] 图片内容审核（鉴黄、暴恐）
- [ ] 视频内容审核（可选）
- [x] 用户举报机制
- [x] 违规内容删除

**实施位置**:
```
后端服务: im-backend/internal/service/content_moderation_service.go
管理后台: 超级管理 -> 内容审核
配置: CONTENT_MODERATION_ENABLED=true
```

**审核流程**:
1. 用户发送消息
2. 后端自动审核（调用阿里云/腾讯云API）
3. 违规内容拦截或标记
4. 管理员人工复核
5. 封禁违规用户

---

#### 2.3 举报机制 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] 用户可举报违规内容
- [x] 管理员审核举报
- [x] 7天内处理举报
- [x] 反馈处理结果

**实施位置**:
```
前端: 聊天窗口 -> 长按消息 -> 举报
后端API: POST /api/reports
管理后台: 超级管理 -> 举报管理
```

---

#### 2.4 违规处理 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] 删除违规内容
- [x] 警告违规用户
- [x] 封禁严重违规用户
- [x] 保存处理记录

**处理措施**:
- 轻微违规：警告
- 一般违规：禁言7天
- 严重违规：永久封禁
- 违法内容：报警并配合调查

---

### 3. 数据安全

#### 3.1 数据加密 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] HTTPS传输加密（TLS 1.2+）
- [x] 数据库敏感字段加密（密码、手机号）
- [ ] 端到端加密（可选）
- [x] 文件存储加密

**实施位置**:
```
传输加密: Nginx SSL配置
数据库加密: AES-256-GCM
配置: ENCRYPTION_KEY=<32字节密钥>
```

---

#### 3.2 日志留存 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] 保留用户操作日志60天以上
- [x] 保留聊天记录（用户可删除，但后台保留）
- [x] 保留IP地址和访问时间
- [x] 配合公安机关调查

**实施位置**:
```
日志路径: /var/log/im-suite/
保留期限: 90天（LOG_RETENTION_DAYS=90）
```

**日志内容**:
```json
{
  "timestamp": "2025-10-11T16:00:00Z",
  "user_id": 12345,
  "ip": "1.2.3.4",
  "action": "send_message",
  "target": "user:67890",
  "content_hash": "abc123..."
}
```

---

#### 3.3 数据备份 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] 定期备份数据库
- [x] 定期备份文件存储
- [x] 备份数据异地存储
- [x] 验证备份可恢复性

**实施位置**:
```
备份脚本: ops/backup_restore.sh
备份频率: 每日凌晨2点
保留策略: 7天/4周/3月
```

---

### 4. 未成年人保护

#### 4.1 青少年模式 [建议]

**状态**: ⚠️ 待实施

**要求**:
- [ ] 提供青少年模式
- [ ] 限制使用时长
- [ ] 限制消费功能
- [ ] 过滤不良内容
- [ ] 家长监护功能

**实施位置**:
```
前端: 设置 -> 青少年模式
后端API: POST /api/users/me/youth-mode
```

---

#### 4.2 儿童信息保护 [必需]

**状态**: ⚠️ 待实施

**要求**:
- [ ] 14岁以下儿童需监护人同意
- [ ] 最小化收集儿童信息
- [ ] 儿童信息加密存储
- [ ] 定期删除儿童信息

**实施位置**:
```
注册流程: 年龄验证
配置: CHILD_PROTECTION_ENABLED=true
```

---

### 5. 安全措施

#### 5.1 访问控制 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] 管理后台权限控制（RBAC）
- [x] 超级管理员/运营/客服分权
- [x] 操作审计日志
- [x] 双因素认证（2FA）

**实施位置**:
```
权限管理: im-backend/internal/middleware/auth.go
管理后台: 超级管理 -> 用户管理
```

---

#### 5.2 漏洞管理 [必需]

**状态**: ✅ 已实施

**要求**:
- [x] 定期安全扫描
- [x] 及时修复漏洞
- [x] 依赖更新管理
- [x] 安全事件响应

**实施位置**:
```
CI/CD: .github/workflows/ci.yml (Trivy扫描)
依赖审计: go audit, npm audit
```

---

#### 5.3 DDoS防护 [建议]

**状态**: ⚠️ 待实施

**要求**:
- [ ] 接入CDN（如Cloudflare、阿里云）
- [x] 速率限制（已实施）
- [ ] IP黑名单
- [ ] 防爬虫机制

---

### 6. 运营资质

#### 6.1 ICP备案 [必需]

**状态**: ❌ 未申请

**要求**:
- [ ] 向当地通信管理局申请ICP备案
- [ ] 网站底部显示备案号
- [ ] 备案信息与实际运营主体一致

**办理流程**:
1. 准备材料（营业执照、身份证、域名证书）
2. 提交备案申请（通过云服务商）
3. 管局审核（20个工作日）
4. 获得备案号（如：京ICP备12345678号）

**网站显示**:
```html
<footer>
  <a href="https://beian.miit.gov.cn" target="_blank">
    京ICP备12345678号
  </a>
</footer>
```

---

#### 6.2 增值电信业务许可证 [可能需要]

**状态**: ❌ 未申请

**说明**:
- 如果提供**付费服务**或**商业运营**，需要申请
- 即时通讯服务可能需要**增值电信业务经营许可证（ICP证）**
- 咨询当地通信管理局

---

#### 6.3 公安备案 [必需]

**状态**: ❌ 未申请

**要求**:
- [ ] 网站开通后30日内向公安机关备案
- [ ] 网站底部显示公安备案号和图标

**办理流程**:
1. 登录 http://www.beian.gov.cn
2. 注册并填写网站信息
3. 提交审核（10个工作日）
4. 获得公安备案号

**网站显示**:
```html
<footer>
  <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802012345" target="_blank">
    <img src="/beian.png" />
    京公网安备 11010802012345号
  </a>
</footer>
```

---

## 📄 必需文档

### 1. 隐私政策模板

**文件**: `im-admin/public/privacy-policy.html`

**必须包含**:
- 个人信息收集清单
- 信息使用目的
- 信息存储期限
- 第三方共享情况
- 用户权利说明
- 联系方式

---

### 2. 用户协议模板

**文件**: `im-admin/public/terms-of-service.html`

**必须包含**:
- 服务内容说明
- 用户行为规范
- 禁止行为清单
- 违规处理措施
- 免责声明
- 争议解决

---

### 3. 应急响应预案

**文件**: `docs/security/incident-response.md`

**必须包含**:
- 安全事件分类
- 响应流程
- 责任人和联系方式
- 与公安机关配合流程

---

## 🔍 合规审计

### 内部审计（每季度）

```bash
# 1. 检查隐私政策是否更新
curl https://im.example.com/privacy-policy | grep "更新日期"

# 2. 检查日志留存
ls -lh /opt/im-suite/backups/ | tail -30

# 3. 检查备份完整性
bash ops/backup_restore.sh restore-test

# 4. 检查内容审核记录
# 管理后台 -> 内容审核 -> 审核记录

# 5. 检查漏洞扫描结果
trivy image im-backend-prod
```

---

### 外部审计（每年）

- 聘请第三方安全公司进行渗透测试
- 隐私合规审计
- 生成合规报告

---

## ⚠️ 风险提示

### 高风险行为（禁止）

- ❌ 传播违法信息
- ❌ 泄露用户隐私
- ❌ 未经同意收集信息
- ❌ 篡改或删除日志
- ❌ 拒绝配合公安调查

### 处罚措施

- 警告、罚款
- 吊销许可证
- 关停服务
- 刑事责任

---

## 📞 合规咨询

### 政府部门

- **国家网信办**: http://www.cac.gov.cn
- **工信部**: https://www.miit.gov.cn
- **公安部网安局**: http://www.mps.gov.cn

### 专业机构

- 网络安全协会
- 律师事务所
- 合规咨询公司

---

## 📋 待办事项

**高优先级**:
- [ ] 创建隐私政策和用户协议页面
- [ ] 实现账号注销功能
- [ ] 实现数据导出功能
- [ ] 申请ICP备案
- [ ] 申请公安备案

**中优先级**:
- [ ] 实现青少年模式
- [ ] 完善内容审核流程
- [ ] 建立应急响应机制

**低优先级**:
- [ ] 考虑申请增值电信业务许可证
- [ ] 接入第三方实名认证服务

---

**更新时间**: 2025-10-11  
**版本**: v1.0.0  
**维护者**: zhihang9978

**免责声明**: 本文档仅供参考，具体合规要求请咨询专业律师和相关政府部门。

